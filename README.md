# Django-CI-CD-NexusRegistry Guide

---

# ูุจู ูุฑ ฺฉุงุฑ ุจุนุฏ ูุงุฑุฏ ุดุฏู

```
sudo apt update && sudo apt upgrade -y

```

#### 1. ูุฑุงุญู ุฏุฑุงูุช Public SSH Key

### 1.1 ุงุฌุงุฏ ฺฉูุฏ SSH

ุจุฑุง ุฏุฑุงูุช Public Key ุณุฑูุฑุ ุงุจุชุฏุง SSH Key ุฌุฏุฏ ุงุฌุงุฏ ูโฺฉูู. ุฏุณุชูุฑ ุฒุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ:

```
ssh-keygen -t rsa -b 4096 -C "abolfazlking22@gmail.com"
```

### 1.2 ูุดุงูุฏู ฺฉูุฏโูุง

ูพุณ ุงุฒ ุงุฌุฑุง ุฏุณุชูุฑ ุจุงูุงุ ฺฉูุฏ SSH ุดูุง ุฏุฑ ูุณุฑ `/root/.ssh/` ุฐุฎุฑู ูโุดูุฏ. ุจุฑุง ูุดุงูุฏู ูุงูโูุง ู ฺฉูุฏ ุฎูุฏุ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
sudo ls -l /root/.ssh/
```

### 1.3 ูุดุงูุฏู Public Key

ุจุฑุง ูุดุงูุฏู Public Keyุ ุฏุณุชูุฑ ุฒุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ:

```bash
sudo cat /root/.ssh/id_rsa.pub
```

ฺฉูุฏ SSH ฺฉู ุจู ุฏุณุช ุขูุฑุฏุฏ ุจุงุฏ ุฏุฑ ุชูุธูุงุช GitHub ุฎูุฏ ูุงุฑุฏ ฺฉูุฏ.

---

## 2. ุงุถุงูู ฺฉุฑุฏู SSH Key ุจู GitHub

1. ุจู ุญุณุงุจ GitHub ุฎูุฏ ูุงุฑุฏ ุดูุฏ.
2. ุจู ุจุฎุด **Settings** ุจุฑูุฏ ู **SSH and GPG Keys** ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ.
3. ุฑู **New SSH Key** ฺฉูฺฉ ฺฉูุฏ ู Public Key ฺฉู ุฏุฑ ูุฑุญูู ูุจู ุฏุฑุงูุช ฺฉุฑุฏูโุงุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ.

---

## 3. ฺฉููู ฺฉุฑุฏู ุฑูพุงุฒุชูุฑ ุงุฒ GitHub

ูพุณ ุงุฒ ุงุถุงูู ฺฉุฑุฏู ฺฉูุฏ SSH ุจู GitHubุ ูโุชูุงูุฏ ูพุฑูฺู ุฑุง ุงุฒ ฺฏุชโูุงุจ ฺฉููู ฺฉูุฏ:

```bash
git clone git@github.com:AbolfazlMohammady/Django-CI-CD-NexsusRegestry.git
```

---

## 4. ุงุณฺฉุฑูพุช `hardening.sh`

ุจุฑุง ุฏุฑุงูุช ุชุบุฑุงุช ุงุฒ ฺฏุช ู ุงุนูุงู ุขูโูุง ุฏุฑ ุณุฑูุฑุ ฺฉ ุงุณฺฉุฑูพุช ุจูุงู `hardening.sh` ุงุฌุงุฏ ูโฺฉูู. ุงุณฺฉุฑูพุช ุดุงูู ุฏุณุชูุฑุงุช ุจุฑุง ุงูุฌุงู ุจุฑูุฒุฑุณุงูโูุง ุงููุช ู ูพฺฉุฑุจูุฏ ุงุณุช.

---

### 4.1 ฺฏุฑูุชู ุขุฎุฑู ุชุบุฑุงุช ุงุฒ ฺฏุช

ุฏุฑ ุฏุงุฎู ุฏุงุฑฺฉุชูุฑ ูพุฑูฺูุ ุงุณฺฉุฑูพุช ุฑุง ุงุฌุฑุง ูโฺฉูู ุชุง ุขุฎุฑู ุชุบุฑุงุช ุฑุง ุงุฒ ฺฏุช ุฏุฑุงูุช ฺฉูู:

```bash
git pull origin
git pull origin main
```

### 4.2 ุฏุงุฏู ุงุฌุงุฒู ุจู ุงุณฺฉุฑูพุช ุจุฑุง ุงุฌุฑุง

ูุจู ุงุฒ ุงุฌุฑุง ุงุณฺฉุฑูพุชุ ุจุงุฏ ุจู ุขู ุงุฌุงุฒู ุงุฌุฑุง ุจุฏูู:

```bash
chmod +x hardening.sh
```

### 4.3 ุงุฌุฑุง ุงุณฺฉุฑูพุช

ุจุฑุง ุงุฌุฑุง ุงุณฺฉุฑูพุช ุจู ุตูุฑุช ูพุณโุฒูููุ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
nohup ./hardening.sh &
```

### 4.4 ููุงุด ุฒูุฏู ูุงฺฏโูุง

ุจุฑุง ูุดุงูุฏู ูุงฺฏโูุง ุฒูุฏู ุงุณฺฉุฑูพุชุ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
tail -f nohup.out
```

### 4.5 ุจุฑุฑุณ ุฎุฑูุฌ ุงุณฺฉุฑูพุช

ุจุฑุง ุจุฑุฑุณ ูุชุงุฌ ู ุฎุฑูุฌ ุงุณฺฉุฑูพุชุ ูุงู `nohup.out` ุฑุง ูโุชูุงูุฏ ุจุฑุฑุณ ฺฉูุฏ:

```bash
cat nohup.out
```

### 4.6 ุจุฑุฑุณ ูพฺฉุฌ ุฏุฑ ุญุงู ุงุฌุฑุง

ุงฺฏุฑ ุฏุฑ ููฺฏุงู ุงุฌุฑุง ุงุณฺฉุฑูพุช ุจุง ุฎุทุง ููุงุฌู ุดุฏุฏุ ููฺฉู ุงุณุช ฺฉู ูพุฑูุณูโุง ุฏุฑ ุญุงู ุงุฌุฑุง ุฏุณุชูุฑ `apt upgrade` ุจุงุดุฏ. ุจุฑุง ุจุฑุฑุณ ุงู ููุถูุนุ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
ps aux | grep apt
```

### 4.7 ุชููู ูพุฑูุณู ุฏุฑ ุญุงู ุงุฌุฑุง

ุงฺฏุฑ ฺฉ ูพุฑูุณู ุจุง ุดูุงุณู ุฎุงุต ุฏุฑ ุญุงู ุงุฌุฑุง ุฏุณุชูุฑ `apt upgrade` ุงุณุชุ ุจุงุฏ ุขู ุฑุง ูุชููู ฺฉูุฏ. ุฏุณุชูุฑ ุฒุฑ ุจุฑุง ุงู ฺฉุงุฑ ุงุณุชูุงุฏู ูโุดูุฏ:

```bash
sudo kill -9 4444
```

---

## 5. ูุตุจ ู ุชุณุช Docker

ุจุฑุง ูุตุจ Docker ู Docker Composeุ ุงุฒ ุฏุณุชูุฑุงุช ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
docker-compose --version
docker --version
```

---

## 6. ุชุณุช ุชุบุฑ ูพูุฑุช SSH

ุจุฑุง ุชุบุฑ ูพูุฑุช SSH ุจู ูพูุฑุช ุฏูุฎูุงู (ูุซูุงู 2226)ุ ุงุจุชุฏุง ุจุงุฏ ูพูุฑุช ุฑุง ุชุณุช ฺฉูุฏ ุชุง ูุทูุฆู ุดูุฏ ุฏุฑ ุญุงู ุงุณุชูุงุฏู ุงุณุช:

```bash
sudo ss -tuln | grep 2226
```

---

## 7. ุชุบุฑ ูพูุฑุช SSH

ุจุนุฏ ุงุฒ ุชุบุฑ ูพูุฑุช ุฏุฑ ูุงู ูพฺฉุฑุจูุฏ SSH (`/etc/ssh/sshd_config`)ุ ุจุฑุง ุงุนูุงู ุชุบุฑุงุช ุจุงุฏ ุณุฑูุณ SSH ุฑุง ุฏูุจุงุฑู ุฑุงูโุงูุฏุงุฒ ฺฉูุฏ:

```bash
sudo systemctl restart ssh
```

---

## 8. ุฑุงูโุญู ุฏูุฑ ุฒุฏู ุชุญุฑูโูุง ุจุฑุง ูพุฑุฏุงุฎุช ูุฒูู ุจู Nginx

ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุฎุฏูุงุช ุฎุงุฑุฌ ูุงููุฏ **Nginx** ู ุฏูุฑ ุฒุฏู ุชุญุฑูโูุงุ ุดูุง ูโุชูุงูุฏ ุงุฒ VPN ุง ุณุฑูุณโูุง ูพุฑูฺฉุณ ุงุณุชูุงุฏู ฺฉูุฏ. ุฏุฑ ุงูุฌุง ฺฉ ุฑุงูฺฉุงุฑ ุณุงุฏู ุจุฑุง ุงุชุตุงู ุจู ุงูุชุฑูุช ุจุฏูู ุชุญุฑูโูุง ุขูุฑุฏู ุดุฏู ุงุณุช:

### 8.1 ูุตุจ ู ูพฺฉุฑุจูุฏ **VPN**

1. ุงุฒ ฺฉ ุงุฒ ุณุฑูุณโุฏููุฏฺฏุงู VPN ูุนุชุจุฑ ุงุณุชูุงุฏู ฺฉูุฏ.
2. ูพุฑูุชฺฉู OpenVPN ุฑุง ูุตุจ ู ูพฺฉุฑุจูุฏ ฺฉูุฏ.
3. ุงุชุตุงู ุจู VPN ุฑุง ุจุฑุง ุชุบุฑ IP ู ุฏุณุชุฑุณ ุจู Nginx ุงุฒ ุฎุงุฑุฌ ฺฉุดูุฑ ูุนุงู ฺฉูุฏ.

### 8.2 ุงุณุชูุงุฏู ุงุฒ **Proxies**

1. ฺฉ ุณุฑูุณ ูพุฑูฺฉุณ ูพุฏุง ฺฉูุฏ ฺฉู ุจู ุดูุง ุงุฌุงุฒู ุฏูุฏ ุจู Nginx ู ุณุงุฑ ุณุฑูุณโูุง ุงุฒ ุฎุงุฑุฌ ุงุฒ ฺฉุดูุฑ ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏ.
2. ุชูุธูุงุช ูพุฑูฺฉุณ ุฑุง ุฏุฑ ูุงูโูุง ูพฺฉุฑุจูุฏ Nginx ุงุนูุงู ฺฉูุฏ.

---

## 9. ุงุณุชูุงุฏู ุงุฒ **Clash Meta** ุจุฑุง ุฏูุฑ ุฒุฏู ุชุญุฑูโูุง ุฏุฑ Docker

### โ ุจูุชุฑู ุฑูุด ุจุฑุง VPS ุฏุงุฎู ุงุฑุงู: ุงุณุชูุงุฏู ุงุฒ **Clash Meta** ุจูโุตูุฑุช ุณุฑูุฑ ฺฉูุงูุช

ุงฺฏุฑ ุงุฒ ุฏุงุฎู ุงุฑุงู ุงุณุชูุงุฏู ูโฺฉูุฏ ู ูุงุฒ ุฏุงุฑุฏ ุชุง ุจุฑุง Docker ุง ุณุงุฑ ุฎุฏูุงุช ุฎุงุฑุฌ ุงุฒ ุงูุชุฑูุช ุจุฏูู ุชุญุฑู ุงุณุชูุงุฏู ฺฉูุฏุ ูุตุจ ู ุฑุงูโุงูุฏุงุฒ **Clash Meta** ฺฉ ุงุฒ ุจูุชุฑู ฺฏุฒููโูุงุณุช. ุฏุฑ ุงุฏุงูู ูุฑุงุญู ูุตุจ ู ูพฺฉุฑุจูุฏ Clash Meta ุจุฑุง ุฏูุฑ ุฒุฏู ุชุญุฑูโูุง ู ุงุณุชูุงุฏู ุงุฒ Docker ุขูุฑุฏู ุดุฏู ุงุณุช.

---

### ๐ฏ ูุฑุงุญู ุฑุงูโุงูุฏุงุฒ Proxsi ุฑู VPS (ุณุงุฏู ู ฺฉุงุฑุจุฑุฏ):

#### 1. ูุตุจ ฺฉุงููฺฏ ุดฺฉู

```
shecan.ir
```

ูุงุฑุฏ ุณุงุช ุดฺฉู ูุดู ู ฺฉ ุงุฒ ุฏ ุงู ุงุณ ูุงุดู ฺฉูพ ูฺฉูู

#### 1.2 ุงุฌุฑุง ุฏุณุชูุฑ

```
vim /etc/resolv.conf

```

ุจุนุฏ ุงุฑ ูุงุฑุฏ ุดุฏู ูุงู ุณุฑูุฑ ุฑู ุนูุถ ูฺฉูู

##### nameserver DNS

DNS ฺฉู ุงุฒ ุดฺฉู ุงูุฑุฏู

#### 1.3 ุงุฌุฑุง ุฏุณุชูุฑ ุฏุงฺฉุฑ

```
docker pull nginx
```


### ุงุฌุฑุง ุฏุณุชูุฑุงุช  ุฏุงฺฉุฑ

```
docker-compose down
```

```
docker-compose up -d --build
```


### โ ูุฏูโุจูโูุฏู ุฑุงูโุงูุฏุงุฒ ูพุฑูฺู Django ุฏุฑ ฺฉุงูุชูุฑ

#### 1. ฺฉููู ฺฉุฑุฏู ูพุฑูฺู ุงุฒ ฺฏุช:

```bash
git clone git@github.com:Mortezakoohjani/TorbatKar-Back.git
cd TorbatKar-Back
```

#### 2. ุณุงุฎุช ู ุงุฌุฑุง ฺฉุงูุชูุฑ:

```bash
docker-compose up --build -d
```

#### 3. ูุฑูุฏ ุจู ฺฉุงูุชูุฑ:

```bash
docker exec -it torbatkar-back-web-1 sh
```

ุชู ุชุฑููุงู ูโุจู ฺุฒ ุดุจู ุงู:

```
/app #
```

#### 4. ุงุนูุงู ูุงฺฏุฑุดูโูุง:

ุญุงูุง ุฏุงุฎู ฺฉุงูุชูุฑ ูุณุชุ ูพุณ ูโุฒู:

```bash
python manage.py migrate
```

#### 5. ุณุงุฎุช ูุฒุฑ ุงุฏูู (ุงฺฏู ูุงุฒ ุจุงุดู):

```bash
python manage.py createsuperuser
```

---

### ๐ ูฺฉุงุช ุงุถุงูู:

* ุงฺฏู ูโุฎูุง ูพุฑูฺู ุฑู ุงุฒ ุจุฑูู ุจุจู:

  * ุชู ูุฑูุฑฺฏุฑ ุจุฒู:
    ```
    http://SERVER_IP:8000
    ```

  ุง ุงฺฏู ููฺฉุงู ูุณุช:

  ```
  http://localhost:8000
  ```
* ุงฺฏู ูพูุฑุชู ุนูุถ ฺฉุฑุฏู ุจุงุด ูุซูุงู ธฐฐฑุ ุงูู ูพูุฑุชู ุจุฒู:

  ```
  http://SERVER_IP:8001
  ```

---

ุงฺฏู ุจุฎูุง ูพุฑูฺู ุฑู ุขูพุฏุช ฺฉู:

#### 6. ุจุฑุง pull ฺฉุฑุฏู ุชุบุฑุงุช:

```bash
git pull origin main
docker-compose down
docker-compose up --build -d
```

---

ูุฑุฌุง ฺฉุงุฑ ูุดฺฉู ุจูุฏ ุง ุฎูุงุณุช ุฏุณุชูุฑุงุช ุฑู ุชู ู ุงุณฺฉุฑูพุช ุชูุฒ ุจุฐุงุฑู ฺฉู ููู ฺุฒู ุจุง ู ุฏุณุชูุฑ ุจุงุฑ ุจุงูุงุ ููุท ุจฺฏู.



ุฏููุงู ููู ฺฉุงุฑู ุฎู ุฎูุจ ุฑูุช ุฌูู ๐ ุญุงูุง ฺฉู ุจุง ููููุช ฺฉุงูุชูุฑ ุจุงูุง ุงููุฏูุ ูุณุฑ ฺฉุงุฑ ุฑู ุงูโุฌูุฑ ูโุชูู ฺฉุงูู ู ุญุฑููโุง ุงุฏุงูู ุจุฏ:

---

### โ ูุฏูโุจูโูุฏู ุฑุงูโุงูุฏุงุฒ ูพุฑูฺู Django ุฏุฑ ฺฉุงูุชูุฑ

#### 1. ฺฉููู ฺฉุฑุฏู ูพุฑูฺู ุงุฒ ฺฏุช:

```bash
git clone git@github.com:Mortezakoohjani/TorbatKar-Back.git
cd TorbatKar-Back
```

#### 2. ุณุงุฎุช ู ุงุฌุฑุง ฺฉุงูุชูุฑ:

```bash
docker-compose up --build -d
```

#### 3. ูุฑูุฏ ุจู ฺฉุงูุชูุฑ:

```bash
docker exec -it torbatkar-back-web-1 sh
```

ุชู ุชุฑููุงู ูโุจู ฺุฒ ุดุจู ุงู:

```
/app #
```

#### 4. ุงุนูุงู ูุงฺฏุฑุดูโูุง:

ุญุงูุง ุฏุงุฎู ฺฉุงูุชูุฑ ูุณุชุ ูพุณ ูโุฒู:

```bash
python manage.py migrate
```

#### 5. ุณุงุฎุช ูุฒุฑ ุงุฏูู (ุงฺฏู ูุงุฒ ุจุงุดู):

```bash
python manage.py createsuperuser
```

---

### ๐ ูฺฉุงุช ุงุถุงูู:

* ุงฺฏู ูโุฎูุง ูพุฑูฺู ุฑู ุงุฒ ุจุฑูู ุจุจู:

  * ุชู ูุฑูุฑฺฏุฑ ุจุฒู:
    ```
    http://SERVER_IP:8000
    ```

  ุง ุงฺฏู ููฺฉุงู ูุณุช:

  ```
  http://localhost:8000
  ```
* ุงฺฏู ูพูุฑุชู ุนูุถ ฺฉุฑุฏู ุจุงุด ูุซูุงู ธฐฐฑุ ุงูู ูพูุฑุชู ุจุฒู:

  ```
  http://SERVER_IP:8001
  ```

---

ุงฺฏู ุจุฎูุง ูพุฑูฺู ุฑู ุขูพุฏุช ฺฉู:

#### 6. ุจุฑุง pull ฺฉุฑุฏู ุชุบุฑุงุช:

```bash
git pull origin main
docker-compose down
docker-compose up --build -d
```

---

ูุฑุฌุง ฺฉุงุฑ ูุดฺฉู ุจูุฏ ุง ุฎูุงุณุช ุฏุณุชูุฑุงุช ุฑู ุชู ู ุงุณฺฉุฑูพุช ุชูุฒ ุจุฐุงุฑู ฺฉู ููู ฺุฒู ุจุง ู ุฏุณุชูุฑ ุจุงุฑ ุจุงูุงุ ููุท ุจฺฏู.
